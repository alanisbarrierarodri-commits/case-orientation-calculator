<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSTK Case Orientation Calculator</title>
<style>
  :root {
    --walmart-blue: #0071ce;
    --walmart-yellow: #ffc220;
    --light-gray: #f5f5f5;
  }
  body {font-family: Arial,sans-serif;margin:0;background:var(--light-gray);}
  header {background:var(--walmart-blue);color:white;padding:15px;text-align:center;font-size:1.4em;font-weight:bold;}
  .container {background:white;max-width:640px;margin:20px auto;padding:20px;border-radius:12px;
              box-shadow:0 4px 10px rgba(0,0,0,0.1);}
  .page {display:none;}
  label {font-weight:bold;display:block;margin-top:10px;}
  input,textarea {
    width:100%;padding:10px;margin:5px 0 12px;border:1px solid #ccc;
    border-radius:8px;font-size:1em;
  }
  button,input[type=submit] {
    padding:10px 16px;margin:8px 4px 0 0;background:var(--walmart-yellow);
    color:black;font-weight:bold;border:none;border-radius:8px;font-size:1em;
    transition:background 0.2s;
  }
  button:hover,input[type=submit]:hover {background:#e6ac00;cursor:pointer;}
  .results-container {margin-top:10px;display:flex;flex-direction:column;gap:20px;
                      max-height:500px;overflow-y:auto;padding-right:8px;}
  .result-card {border:2px solid var(--walmart-blue);border-radius:12px;
                box-shadow:0 2px 6px rgba(0,0,0,0.15);padding:15px;background:#f8fbff;}
  .result-header {font-size:1.1em;font-weight:bold;color:white;
                  background:var(--walmart-blue);padding:6px 10px;border-radius:8px;margin-bottom:8px;}
  .result-metrics span {display:inline-block;margin-right:15px;font-weight:bold;color:#333;}
  .result-metrics .highlight {color:var(--walmart-yellow);}
  .view-container {display:flex;justify-content:space-around;flex-wrap:wrap;gap:10px;}
  .view {border:1px solid #ccc;background:white;padding:8px;border-radius:8px;text-align:center;}
  canvas {display:block;max-width:100%;height:auto;}
</style>
</head>
<body>
<header>SSTK Case Orientation Calculator</header>
<div class="container">

  <!-- PAGE 1 -->
  <div class="page" id="page-1" style="display:block;">
    <label for="itemNumber">Item #:</label>
    <input type="text" id="itemNumber">
    <button onclick="nextPage()">Next</button>
  </div>

  <!-- PAGE 2 -->
  <div class="page" id="page-2">
    <label for="height">Height (inches):</label>
    <input type="number" id="height" step="0.01">
    <label for="length">Length (inches): <small>Longest side</small></label>
    <input type="number" id="length" step="0.01">
    <label for="width">Width (inches): <small>Shortest side</small></label>
    <input type="number" id="width" step="0.01">
    <button onclick="prevPage()">Previous</button>
    <button onclick="nextPage()">Next</button>
  </div>

  <!-- PAGE 3 -->
  <div class="page" id="page-3">
    <label>Select Slot Sizes (choose one or more):</label>
    <div id="slot-options">
      <label><input type="checkbox" value="30"> 30"</label><br>
      <label><input type="checkbox" value="40"> 40"</label><br>
      <label><input type="checkbox" value="50"> 50"</label><br>
      <label><input type="checkbox" value="60"> 60"</label><br>
      <label><input type="checkbox" value="71"> 71"</label><br>
      <label><input type="checkbox" value="73"> 73"</label><br>
      <label><input type="checkbox" value="75"> 75"</label><br>
      <label><input type="checkbox" value="110"> 110"</label><br>
    </div>
    <button onclick="prevPage()">Previous</button>
    <button onclick="calculate()">Calculate</button>
  </div>

  <!-- PAGE 4 (Results & Contact Form) -->
  <div class="page" id="page-4">
    <div class="results-container" id="results"></div>

    <!-- ✅ Contact Form -->
    <form id="contactForm" action="send_email.php" method="post" style="margin-top:20px;">
      <h3>Send Results</h3>
      <label for="firstName">First Name:</label>
      <input type="text" id="firstName" name="firstName" required>

      <label for="email">Email Address:</label>
      <input type="email" id="email" name="email" required>

      <label for="message">Message:</label>
      <textarea id="message" name="message" placeholder="Any notes..." required></textarea>

      <!-- Hidden fields to hold calculation results -->
      <input type="hidden" id="calcTI" name="calcTI">
      <input type="hidden" id="calcHI" name="calcHI">
      <input type="hidden" id="calcTotal" name="calcTotal">
      <input type="hidden" id="calcSlot" name="calcSlot">
      <input type="hidden" id="topViewImage" name="topViewImage">

      <input type="submit" value="Send Results">
    </form>

    <button onclick="prevPage()">Previous</button>
  </div>

</div>

<script>
let currentPage = 1;
function showPage(n){document.querySelectorAll('.page').forEach((p,i)=>p.style.display=(i+1===n)?'block':'none');currentPage=n;}
function nextPage(){showPage(Math.min(currentPage+1,4));}
function prevPage(){showPage(Math.max(currentPage-1,1));}

// Simple packing logic
function packLayer(palletL,palletW,boxL,boxW){
  let freeRects=[{x:0,y:0,w:palletL,h:palletW}],placements=[],boxArea=boxL*boxW;
  while(true){
    let best=null;
    for(let ri=0;ri<freeRects.length;ri++){
      const r=freeRects[ri];
      if(boxL<=r.w && boxW<=r.h){
        const waste=r.w*r.h-boxArea;
        if(!best||waste<best.waste) best={ri,rot:0,waste,p:{x:r.x,y:r.y,w:boxL,h:boxW}};
      }
      if(boxW<=r.w && boxL<=r.h){
        const waste=r.w*r.h-boxArea;
        if(!best||waste<best.waste) best={ri,rot:1,waste,p:{x:r.x,y:r.y,w:boxW,h:boxL}};
      }
    }
    if(!best) break;
    placements.push({...best.p,rot:best.rot});
    const used=freeRects[best.ri];
    freeRects.splice(best.ri,1);
    const rightW=used.w-best.p.w;
    if(rightW>0.0001) freeRects.push({x:used.x+best.p.w,y:used.y,w:rightW,h:best.p.h});
    const bottomH=used.h-best.p.h;
    if(bottomH>0.0001) freeRects.push({x:used.x,y:used.y+best.p.h,w:used.w,h:bottomH});
  }
  return placements;
}

function calculate(){
  const boxLength=parseFloat(document.getElementById('length').value);
  const boxWidth =parseFloat(document.getElementById('width').value);
  const boxHeight=parseFloat(document.getElementById('height').value);
  const palletLength=47, palletWidth=40;
  const slotSizes=[...document.querySelectorAll('#slot-options input:checked')].map(el=>parseInt(el.value));
  const results=document.getElementById('results');
  results.innerHTML="";
  if([boxLength,boxWidth,boxHeight].some(v=>isNaN(v)||v<=0)){
    results.innerHTML="<div class='result-card'>Please enter valid numbers.</div>";showPage(4);return;
  }
  if(slotSizes.length===0){
    results.innerHTML="<div class='result-card'>Please select at least one slot size.</div>";showPage(4);return;
  }

  // For simplicity store the FIRST slot result in hidden fields
  let firstTopCanvas=null;
  slotSizes.forEach((slot,idx)=>{
    const hi=Math.floor(slot/boxHeight);
    if(hi<=0){results.innerHTML+=`<div class="result-card"><div class="result-header">Slot Size: ${slot}"</div>
      <div>Case height exceeds slot height.</div></div>`;return;}
    let total=0,layers=[];
    for(let i=0;i<hi;i++){const p=packLayer(palletLength,palletWidth,boxLength,boxWidth);total+=p.length;layers.push(p);}
    const ti=layers.length?layers[0].length:0;
    const card=document.createElement('div');
    card.className="result-card";
    card.innerHTML=`
      <div class="result-header">Slot Size: ${slot}"</div>
      <div class="result-metrics">
        <span>TI: <span class="highlight">${ti}</span></span>
        <span>HI: <span class="highlight">${hi}</span></span>
        <span>Total: <span class="highlight">${total}</span></span>
      </div>
      <div class="view-container">
        <div class="view"><strong>Top View</strong><br/></div>
        <div class="view"><strong>Front View</strong><br/></div>
      </div>`;
    results.appendChild(card);
    const topCanvas=document.createElement('canvas');
    const frontCanvas=document.createElement('canvas');
    card.querySelectorAll('.view')[0].appendChild(topCanvas);
    card.querySelectorAll('.view')[1].appendChild(frontCanvas);
    drawPacked({layers,palletLength,palletWidth,boxLength,boxWidth,boxHeight,hi,topCanvas,frontCanvas});
    if(idx===0) firstTopCanvas=topCanvas;

    // ✅ Populate hidden fields for the first slot
    if(idx===0){
      document.getElementById('calcTI').value=ti;
      document.getElementById('calcHI').value=hi;
      document.getElementById('calcTotal').value=total;
      document.getElementById('calcSlot').value=slot;
      // Canvas snapshot
      document.getElementById('topViewImage').value = topCanvas.toDataURL("image/png");
    }
  });
  showPage(4);
}

function drawPacked({layers,palletLength,palletWidth,boxLength,boxWidth,boxHeight,hi,topCanvas,frontCanvas}){
  const scale=300/Math.max(palletLength,palletWidth);
  topCanvas.width=palletLength*scale;
  topCanvas.height=palletWidth*scale;
  const ctx=topCanvas.getContext('2d');
  ctx.clearRect(0,0,topCanvas.width,topCanvas.height);
  ctx.strokeStyle="#0071ce";ctx.lineWidth=2;
  ctx.strokeRect(0,0,topCanvas.width,topCanvas.height);
  ctx.fillStyle="#000";ctx.font="14px Arial";
  ctx.fillText("Pallet Longest Side",(topCanvas.width-ctx.measureText("Pallet Longest Side").width)/2,16);
  ctx.save();
  ctx.translate(14, topCanvas.height/2 + ctx.measureText("Pallet Shortest Side").width/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText("Pallet Shortest Side",0,0);
  ctx.restore();
  if(layers[0].length>0){
    layers[0].forEach(p=>{
      ctx.fillStyle="#ffc220";
      ctx.fillRect(p.x*scale,p.y*scale,p.w*scale,p.h*scale);
      ctx.strokeStyle="#333";
      ctx.strokeRect(p.x*scale,p.y*scale,p.w*scale,p.h*scale);
    });
  }
  frontCanvas.width=palletLength*scale;
  const vScale=scale/2;
  frontCanvas.height=Math.max(80,boxHeight*hi*vScale);
  const fctx=frontCanvas.getContext('2d');
  fctx.clearRect(0,0,frontCanvas.width,frontCanvas.height);
  fctx.strokeStyle="#0071ce";
  fctx.strokeRect(0,frontCanvas.height-2,frontCanvas.width,2);
  layers.forEach((layer,idx)=>{
    const yTop=frontCanvas.height-(idx+1)*boxHeight*vScale;
    layer.forEach(p=>{
      fctx.fillStyle="#ffc220";
      fctx.fillRect(p.x*scale,yTop,p.w*scale,boxHeight*vScale);
      fctx.strokeStyle="#333";
      fctx.strokeRect(p.x*scale,yTop,p.w*scale,boxHeight*vScale);
    });
  });
}
</script>
</body>
</html>





